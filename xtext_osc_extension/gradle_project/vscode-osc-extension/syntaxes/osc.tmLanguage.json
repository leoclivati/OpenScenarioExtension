{
   "name":"OpenSCENARIO",
   "scopeName":"source.osc",
   "patterns":[
      {
         "include":"#statement"
      }
   ],
   "repository":{
      "statement":{
         "patterns":[
            {
               "include":"#comment"
            },
            {
               "include":"#keyword"
            },
            {
               "include":"#literal"
            }
         ]
      },
      "keyword":{
         "patterns":[
            {
               "name":"keyword.namespace.osc",
               "match":"\\b(namespace|global|use)\\b"
            },
            {
               "name":"keyword.control.flow.osc",
               "match":"\\b(with|do|on)\\b"
            },
            {
               "name":"keyword.control.import.osc",
               "match":"\\b(import)\\b"
            },
            {
               "name":"keyword.control.export.osc",
               "match":"\\b(export)\\b"
            },
            {
               "name":"support.function.builtin.osc",
               "match":"(?<!\\.)\\b(keep|until|cover|record)\\b"
            },
            {
               "name":"support.function.library.osc",
               "match":"\\b(\\w+)((?=\\s*\\())"
            },
            {
               "name":"keyword.method.implementation.osc",
               "match":"\\b(expression|external|undefined)\\b"
            },
            {
               "name":"keyword.other.osc",
               "match":"\\b(extend|inherits|on|as|is|if|emit|only|call|default|hard|in|it|of|range|remove_default|sample|wait)\\b"
            },
            {
               "name":"keyword.operators.osc",
               "match":"\\b(and|or|not)\\b"
            },
            {
               "name":"keyword.event.condition.osc",
               "match":"\\b(elapsed|rise|fall|every)\\b"
            },
            {
               "name":"keyword.grammar.commands.osc",
               "match": "\\b(SI|factor|offset)\\b" 
            },
            {
               "name":"keyword.grammar.unit.osc",
               "match": "\\b(kg|m|s|A|K|mol|cd|rad)\\b"
            },
            {
               "include":"#declaration"
            },
            {
               "include":"#primitive-type"
            },
            {
               "include":"#composition-operator"
            }
         ]
      },
      "declaration":{
         "patterns":[
            {
               "include":"#class-name"
            },
            {
               "name":"storage.type.function.osc",
               "match":"\\b(def)\\b"
            },
            {
               "name":"storage.type.function.parameter.osc",
               "match":"\\b(\\w+)(?=.*\\))(?=: )\\b"
            },
            {
               "include":"#field-declaration"
            }
         ]
      },
      "field-declaration":{
         "patterns":[
            {
               "name":"meta.class.osc",
               "begin":"\\b(?<=: )(?!.*\\))(?=\\w*)",
               "end":" ",
               "patterns":[
                  {
                     "include":"#class-name"
                  },
                  {
                     "name": "entity.name.type.class.osc",
                     "match":"\\b(?<=: )(?!.*\\))(\\w*)"
                  }
               ]
            }
         ]
      },
      "class-name":{
         "patterns":[
            {
               "name":"entity.name.type.class.osc",
               "match":"\\b(type|unit|actor|enum|struct|action|scenario|modifier|var|event)\\b"
            },
            {
               "include":"#primitive-type"
            }
         ]
      },
      "method-declaration":{
           "patterns":[
               {
                   "name":"keyword.method.declaration.osc",
                   "match":"\\b(expression|external|undefined)\\b"
               }
           ]

      },
      "primitive-type":{
         "patterns":[
            {
               "name":"support.type.osc",
               "match":"(?<!\\.)\\b(int|uint|float|string|bool)\\b"
            },
            {
               "name":"support.list.osc",
               "match":"(?<!\\.)\\b(list)\\b"
            }
         ]
      },
      "composition-operator":{
         "patterns":[
            {
               "name":"keyword.control.flow.temporal.osc",
               "match":"\\b(serial|parallel|one_of)\\b"
            }
         ]
      },
      "comment":{
         "patterns":[
            {
               "name":"comment.block.osc",
               "begin":"(\"{3,})$",
               "end":"\"{3,}$"
            },
            {
               "name":"comment.inline.osc",
               "match":"(#+).*$"
            }
         ]
      },
      "string":{
         "patterns":[
            {
               "name":"string.quoted.double.osc",
               "begin":"\"",
               "end":"\""
            },
            {
               "name":"string.quoted.single.osc",
               "begin":"'",
               "end":"'"
            },
            {
               "name":"string.quoted.multisingle.osc",
               "begin":"'''",
               "end":"'''"
            },
            {
               "name":"string.quoted.multidouble.osc",
               "begin":"\"\"\"",
               "end":"\"\"\""
            }
         ]
      },
      "bool":{
         "patterns":[
            {
               "name":"constant.language.osc",
               "match":"\\b(true|false)\\b"
            }
         ]
      },
      "literal":{
         "patterns":[
            {
               "include":"#number"
            },
            {
               "include":"#bool"
            },
            {
               "include":"#string"
            },
            {
               "include":"#si-units"
            }
         ]
      },
      "number":{
         "name":"constant.numeric.osc",
         "patterns":[
            {
               "include":"#number-int"
            },
            {
               "include":"#number-float"
            },
            {
               "name":"constant.numeric.literal.osc",
               "match":"\\b(inf|nan|null)\\b"
            }
         ]
      },
      "number-float":{
         "match":"\\b([0-9]+[\\.][0-9]+)([\\w]+)?\\b",
         "captures":{
            "1":{
               "name":"constant.numeric.float.osc"
            },
            "2":{
               "name":"constant.other.physicaltype.osc"
            }
         }
      },
      "number-int":{
         "patterns":[
            {
               "match":"\\b(?<!\\.)([1-9]{1,}[0-9]+)(?!\\.)(\\w+)?\\b",
               "captures":{
                  "1":{
                     "name":"constant.numeric.integer.osc"
                  },
                  "2":{
                     "name":"constant.other.physicaltype.osc"
                  }
               }
            },
            {
               "match":"\\b(?<!\\.)([0-9])(?!\\.)([a-zA-Z]+)?\\b",
               "captures":{
                  "1":{
                     "name":"constant.numeric.integer.osc"
                  },
                  "2":{
                     "name":"constant.other.physicaltype.osc"
                  }
               }
            }
         ]
      },
      "si-units":{
         "patterns":[
            {
               "name":"constant.numeric.unit.osc",
               "match":"(?<=\\d+\\s*)([a-zA-Z]+)"
            }
         ]
      }
   }
}